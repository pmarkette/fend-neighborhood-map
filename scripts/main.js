"use strict";function loadScript(){var e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB82oaqh1VTxwsHD3XH5ZjFi5CFMBFQdvE&callback=initialize",e.onerror=function(){alert("Google maps could not be loaded")},document.body.appendChild(e)}function initialize(){ko.applyBindings(new ViewModel)}var beers=[{name:"Linden Street Brewery",lat:37.7994985,lng:-122.2879045,phone:"+15102518898"},{name:"Pacific Coast Brewing Co",lat:37.8015344,lng:-122.2741712,phone:"+15108362739"},{name:"Diving Dog Brewhouse",lat:37.8076629,lng:-122.2696182,phone:"+15103061914"},{name:"Beer Revolution",lat:37.7971749,lng:-122.2762197,phone:"+15104522337"},{name:"The Trappist",lat:37.8005481,lng:-122.2741687,phone:"+15102388900"},{name:"Drakeâ€™s Dealership",lat:37.8125182,lng:-122.2661527,phone:"+15108336649"},{name:"Lost & Found",lat:37.8101575,lng:-122.2691598,phone:"+15107632040"},{name:"Woods Bar & Brewery",lat:37.8070162,lng:-122.2705888,phone:"+15107618617"},{name:"Independent Brewing Co.",lat:37.7964226,lng:-122.2712658,phone:"+15106982337"},{name:"Ale Industries",lat:37.7762289,lng:-122.2281795,phone:"+15104793185"}],Location=function(e){this.name=ko.observable(e.name),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.phone=ko.observable(e.phone),this.stars=ko.observable(),this.desc=ko.observable(),this.address0=ko.observable(),this.address1=ko.observable(),this.address2=ko.observable(),this.displayPhone=ko.observable()},ViewModel=function(){var e=this,t="https://www.google.com/mapfiles/marker.png",s="https://www.google.com/mapfiles/marker_green.png";e.beerList=ko.observableArray([]);var o=[];e.filter=ko.observable(""),e.currentLocation=ko.observable("Oakland, CA"),beers.forEach(function(t){e.beerList.push(new Location(t))}),this.drawMap=function(){for(var n={zoom:14,center:new google.maps.LatLng(37.796432,-122.2734581),mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT}},a=new google.maps.Map(document.getElementsByClassName("map-canvas")[0],n),r=new google.maps.InfoWindow({content:"",maxWidth:300}),i=0;i<e.beerList().length;i++){var l={consumerKey:"qFWyVzFIKPXKkGvIb9GguQ",consumerSecret:"mCB7OIoZbSBYBCSSiCRXNvLh_bQ",accessToken:"W5N9KRmGnciuZenun9HOVsGY2UHy2sja",accessTokenSecret:"ErBWeQIdAGrL9MlGE2m6nUxG2IM",serviceProvider:{signatureMethod:"HMAC-SHA1"}},c=e.beerList()[i].phone(),d={consumerSecret:l.consumerSecret,tokenSecret:l.accessTokenSecret},p=[];p.push(["phone",c]),p.push(["callback","cb"]),p.push(["oauth_consumer_key",l.consumerKey]),p.push(["oauth_consumer_secret",l.consumerSecret]),p.push(["oauth_token",l.accessToken]),p.push(["oauth_signature_method","HMAC-SHA1"]);var u={action:"https://api.yelp.com/v2/phone_search",method:"GET",parameters:p};OAuth.setTimestampAndNonce(u),OAuth.SignatureMethod.sign(u,d);var m=OAuth.getParameterMap(u.parameters);m.oauth_signature=OAuth.percentEncode(m.oauth_signature),function(n){var i=setTimeout(function(){alert("Failed to get data from Yelp")},8e3);$.ajax({url:u.action,data:m,cache:!0,dataType:"jsonp",success:function(l,c,d){e.beerList()[n].stars(l.businesses[0].rating_img_url),e.beerList()[n].desc(l.businesses[0].snippet_text),e.beerList()[n].address0(l.businesses[0].location.display_address[0]),e.beerList()[n].address1(l.businesses[0].location.display_address[1]),e.beerList()[n].address2(l.businesses[0].location.display_address[2]),e.beerList()[n].displayPhone(l.businesses[0].display_phone);var p='<div id="content"><h2 class="infoName">'+e.beerList()[n].name()+'</h2><div><img src="'+e.beerList()[n].stars()+'" /></div><div>'+e.beerList()[n].desc()+"</div><div>"+e.beerList()[n].address0()+"</div><div>"+e.beerList()[n].address1()+"</div><div>"+e.beerList()[n].address2()+"</div><div>"+e.beerList()[n].displayPhone()+"</div></div>";r.content=p;var u=new google.maps.LatLng(e.beerList()[n].lat(),e.beerList()[n].lng()),m=new google.maps.Marker({position:u,map:a,title:e.beerList()[n].name(),icon:s});o.push(m),google.maps.event.addListener(m,"click",e.markerReset),google.maps.event.addListener(r,"closeclick",e.markerReset),google.maps.event.addListener(m,"click",function(s,o,n){return function(){r.close(),r.setContent(o),r.open(a,this),e.currentLocation(this.title),s.setIcon(t)}}(m,p,r)),clearTimeout(i)}})}(i)}},e.markerReset=function(){for(var e=0;e<o.length;e++)o[e].setIcon(s)},e.stringStartsWith=function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},e.filteredItems=ko.computed(function(){var t=e.filter().toLowerCase();return t?ko.utils.arrayFilter(e.beerList(),function(s){return e.stringStartsWith(s.name().toLowerCase(),t)}):e.beerList()},e.beerList,o),e.filteredMarkers=ko.computed(function(){for(var t=0;t<e.filteredItems().length;t++)for(var s=0;s<o.length;s++)o[s].title===e.filteredItems()[t].name()?o[s].setVisible(!0):o[s].setVisible(!1);var n=e.filter().toLowerCase();if(!n)for(var a=0;a<o.length;a++)o[a].setVisible(!0)},e.filteredItems,o),e.selectBeer=function(s,n){e.markerReset();for(var a,r=s.name(),i=0;i<o.length;i++)r===o[i].title&&(a=o[i],o[i].setIcon(t),e.currentLocation(r));google.maps.event.trigger(a,"click")},e.drawMap();var n=document.querySelector("#menu"),a=document.querySelector("#drawer");n.addEventListener("click",function(e){a.classList.toggle("open"),n.classList.toggle("is-active"),e.stopPropagation()})};window.onload=loadScript;