"use strict";function loadScript(){var e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB82oaqh1VTxwsHD3XH5ZjFi5CFMBFQdvE&callback=initialize",e.onerror=function(){alert("Google maps could not be loaded")},document.body.appendChild(e)}function initialize(){ko.applyBindings(new ViewModel)}var beers=[{name:"Linden Street Brewery",lat:37.7994396,lng:-122.2882671,phone:"+15102518898"},{name:"Pacific Coast Brewing Co",lat:37.801542,lng:-122.2764502,phone:"+15108362739"},{name:"Diving Dog Brewhouse",lat:37.8077394,lng:-122.2720127,phone:"+15103061914"},{name:"Beer Revolution",lat:37.797173,lng:-122.2784187,phone:"+15104522337"},{name:"The Trappist",lat:37.8005888,lng:-122.2763285,phone:"+15102388900"},{name:"Drakeâ€™s Dealership",lat:37.8126375,lng:-122.2686281,phone:"+15108336649"},{name:"Lost & Found",lat:37.8101617,lng:-122.271404,phone:"+15107632040"},{name:"Woods Bar & Brewery",lat:37.807009,lng:-122.2726781,phone:"+15107618617"},{name:"Independent Brewing Co.",lat:37.796432,lng:-122.2734581,phone:"+15106982337"},{name:"Ale Industries",lat:37.776209,lng:-122.2303851,phone:"+19254705280"}],Location=function(e){this.name=ko.observable(e.name),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.phone=ko.observable(e.phone),this.stars=ko.observable(),this.desc=ko.observable(),this.address0=ko.observable(),this.address1=ko.observable(),this.address2=ko.observable(),this.displayPhone=ko.observable()},ViewModel=function(){var e=this,s="https://www.google.com/mapfiles/marker.png",t="https://www.google.com/mapfiles/marker_green.png",o="red",n="green";e.beerList=ko.observableArray([]);var r=[];e.filter=ko.observable(""),e.currentLocation=ko.observable("Oakland, CA"),beers.forEach(function(s){e.beerList.push(new Location(s))}),this.drawMap=function(){for(var o={zoom:14,center:new google.maps.LatLng(37.796432,-122.2734581),mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT}},n=new google.maps.Map(document.getElementsByClassName("map-canvas")[0],o),a=0;a<e.beerList().length;a++){var i={consumerKey:"qFWyVzFIKPXKkGvIb9GguQ",consumerSecret:"mCB7OIoZbSBYBCSSiCRXNvLh_bQ",accessToken:"W5N9KRmGnciuZenun9HOVsGY2UHy2sja",accessTokenSecret:"ErBWeQIdAGrL9MlGE2m6nUxG2IM",serviceProvider:{signatureMethod:"HMAC-SHA1"}},l=e.beerList()[a].phone(),c={consumerSecret:i.consumerSecret,tokenSecret:i.accessTokenSecret},d=[];d.push(["phone",l]),d.push(["callback","cb"]),d.push(["oauth_consumer_key",i.consumerKey]),d.push(["oauth_consumer_secret",i.consumerSecret]),d.push(["oauth_token",i.accessToken]),d.push(["oauth_signature_method","HMAC-SHA1"]);var p={action:"https://api.yelp.com/v2/phone_search",method:"GET",parameters:d};OAuth.setTimestampAndNonce(p),OAuth.SignatureMethod.sign(p,c);var g=OAuth.getParameterMap(p.parameters);g.oauth_signature=OAuth.percentEncode(g.oauth_signature),function(s){$.ajax({url:p.action,data:g,cache:!0,dataType:"jsonp",success:function(t,o,n){e.beerList()[s].stars(t.businesses[0].rating_img_url),console.log(e.beerList()[s].stars()),e.beerList()[s].desc(t.businesses[0].snippet_text),e.beerList()[s].address0(t.businesses[0].location.display_address[0]),e.beerList()[s].address1(t.businesses[0].location.display_address[1]),e.beerList()[s].address2(t.businesses[0].location.display_address[2]),e.beerList()[s].displayPhone(t.businesses[0].display_phone),console.log(e.beerList()[s].address0())}})}(a);var h='<div id="content"><h2 class="infoName">'+e.beerList()[a].name()+'</h2><div><img src="'+e.beerList()[a].stars()+'" /></div><div>'+e.beerList()[a].desc()+"</div><div>"+e.beerList()[a].address0()+"</div><div>"+e.beerList()[a].address1()+"</div><div>"+e.beerList()[a].address2()+"</div><div>"+e.beerList()[a].displayPhone()+"</div></div>",m=new google.maps.InfoWindow({content:h}),u=new google.maps.LatLng(e.beerList()[a].lat(),e.beerList()[a].lng()),b=new google.maps.Marker({position:u,map:n,title:e.beerList()[a].name(),icon:t});r.push(b),google.maps.event.addListener(b,"click",e.markerReset),google.maps.event.addListener(m,"closeclick",e.markerReset),google.maps.event.addListener(b,"click",function(t,o,r){return function(){m.setContent(o),m.open(n,this),e.currentLocation(this.title),t.setIcon(s)}}(b,h,m))}},e.markerReset=function(){for(var e=0;e<r.length;e++)r[e].setIcon(t),$("h3").css("color",n)},e.stringStartsWith=function(e,s){return e=e||"",s.length>e.length?!1:e.substring(0,s.length)===s},e.filteredItems=ko.computed(function(){var s=e.filter().toLowerCase();return s?ko.utils.arrayFilter(e.beerList(),function(t){return e.stringStartsWith(t.name().toLowerCase(),s)}):e.beerList()},e.beerList,r),e.filteredMarkers=ko.computed(function(){for(var s=0;s<e.filteredItems().length;s++)for(var t=0;t<r.length;t++)r[t].title===e.filteredItems()[s].name()?r[t].setVisible(!0):r[t].setVisible(!1);var o=e.filter().toLowerCase();if(!o)for(var n=0;n<r.length;n++)r[n].setVisible(!0)},e.filteredItems,r),e.selectBeer=function(t,n){e.markerReset();for(var a,i=$(n.target).text(),l=0;l<e.beerList().length;l++)i===e.beerList()[l].name()&&(a=r[l],r[l].setIcon(s),e.currentLocation(i));$(n.target).css("color",o),google.maps.event.trigger(a,"click")},e.drawMap()};window.onload=loadScript;