"use strict";function loadScript(){var e=document.createElement("script");e.type="text/javascript",e.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB82oaqh1VTxwsHD3XH5ZjFi5CFMBFQdvE&callback=initialize",e.onerror=function(){alert("Google maps could not be loaded")},document.body.appendChild(e)}function initialize(){ko.applyBindings(new ViewModel)}var beers=[{name:"Linden Street Brewery",lat:37.7994985,lng:-122.2879045,phone:"+15102518898"},{name:"Pacific Coast Brewing Co",lat:37.8015344,lng:-122.2741712,phone:"+15108362739"},{name:"Diving Dog Brewhouse",lat:37.8076629,lng:-122.2696182,phone:"+15103061914"},{name:"Beer Revolution",lat:37.7971749,lng:-122.2762197,phone:"+15104522337"},{name:"The Trappist",lat:37.8005481,lng:-122.2741687,phone:"+15102388900"},{name:"Drakeâ€™s Dealership",lat:37.8125182,lng:-122.2661527,phone:"+15108336649"},{name:"Lost & Found",lat:37.8101575,lng:-122.2691598,phone:"+15107632040"},{name:"Woods Bar & Brewery",lat:37.8070162,lng:-122.2705888,phone:"+15107618617"},{name:"Independent Brewing Co.",lat:37.7964226,lng:-122.2712658,phone:"+15106982337"},{name:"Ale Industries",lat:37.7762289,lng:-122.2281795,phone:"+15104793185"}],Location=function(e){this.name=ko.observable(e.name),this.lat=ko.observable(e.lat),this.lng=ko.observable(e.lng),this.phone=ko.observable(e.phone),this.stars=ko.observable(),this.desc=ko.observable(),this.address0=ko.observable(),this.address1=ko.observable(),this.address2=ko.observable(),this.displayPhone=ko.observable()},ViewModel=function(){var e=this,t="https://www.google.com/mapfiles/marker.png",s="https://www.google.com/mapfiles/marker_green.png",o="red",n="green";e.beerList=ko.observableArray([]);var r=[];e.filter=ko.observable(""),e.currentLocation=ko.observable("Oakland, CA"),beers.forEach(function(t){e.beerList.push(new Location(t))}),this.drawMap=function(){for(var o={zoom:14,center:new google.maps.LatLng(37.796432,-122.2734581),mapTypeControlOptions:{style:google.maps.MapTypeControlStyle.HORIZONTAL_BAR,position:google.maps.ControlPosition.TOP_RIGHT}},n=new google.maps.Map(document.getElementsByClassName("map-canvas")[0],o),a=new google.maps.InfoWindow({content:"",maxWidth:300}),i=0;i<e.beerList().length;i++){var l={consumerKey:"qFWyVzFIKPXKkGvIb9GguQ",consumerSecret:"mCB7OIoZbSBYBCSSiCRXNvLh_bQ",accessToken:"W5N9KRmGnciuZenun9HOVsGY2UHy2sja",accessTokenSecret:"ErBWeQIdAGrL9MlGE2m6nUxG2IM",serviceProvider:{signatureMethod:"HMAC-SHA1"}},c=e.beerList()[i].phone(),d={consumerSecret:l.consumerSecret,tokenSecret:l.accessTokenSecret},p=[];p.push(["phone",c]),p.push(["callback","cb"]),p.push(["oauth_consumer_key",l.consumerKey]),p.push(["oauth_consumer_secret",l.consumerSecret]),p.push(["oauth_token",l.accessToken]),p.push(["oauth_signature_method","HMAC-SHA1"]);var u={action:"https://api.yelp.com/v2/phone_search",method:"GET",parameters:p};OAuth.setTimestampAndNonce(u),OAuth.SignatureMethod.sign(u,d);var g=OAuth.getParameterMap(u.parameters);g.oauth_signature=OAuth.percentEncode(g.oauth_signature),function(o){$.ajax({url:u.action,data:g,cache:!0,dataType:"jsonp",success:function(i,l,c){e.beerList()[o].stars(i.businesses[0].rating_img_url),e.beerList()[o].desc(i.businesses[0].snippet_text),e.beerList()[o].address0(i.businesses[0].location.display_address[0]),e.beerList()[o].address1(i.businesses[0].location.display_address[1]),e.beerList()[o].address2(i.businesses[0].location.display_address[2]),e.beerList()[o].displayPhone(i.businesses[0].display_phone);var d='<div id="content"><h2 class="infoName">'+e.beerList()[o].name()+'</h2><div><img src="'+e.beerList()[o].stars()+'" /></div><div>'+e.beerList()[o].desc()+"</div><div>"+e.beerList()[o].address0()+"</div><div>"+e.beerList()[o].address1()+"</div><div>"+e.beerList()[o].address2()+"</div><div>"+e.beerList()[o].displayPhone()+"</div></div>";a.content=d;var p=new google.maps.LatLng(e.beerList()[o].lat(),e.beerList()[o].lng()),u=new google.maps.Marker({position:p,map:n,title:e.beerList()[o].name(),icon:s});r.push(u),google.maps.event.addListener(u,"click",e.markerReset),google.maps.event.addListener(a,"closeclick",e.markerReset),google.maps.event.addListener(u,"click",function(s,o,r){return function(){a.close(),a.setContent(o),a.open(n,this),e.currentLocation(this.title),s.setIcon(t)}}(u,d,a))}})}(i)}},e.markerReset=function(){for(var e=0;e<r.length;e++)r[e].setIcon(s),$("h3").css("color",n)},e.stringStartsWith=function(e,t){return e=e||"",t.length>e.length?!1:e.substring(0,t.length)===t},e.filteredItems=ko.computed(function(){var t=e.filter().toLowerCase();return t?ko.utils.arrayFilter(e.beerList(),function(s){return e.stringStartsWith(s.name().toLowerCase(),t)}):e.beerList()},e.beerList,r),e.filteredMarkers=ko.computed(function(){for(var t=0;t<e.filteredItems().length;t++)for(var s=0;s<r.length;s++)r[s].title===e.filteredItems()[t].name()?r[s].setVisible(!0):r[s].setVisible(!1);var o=e.filter().toLowerCase();if(!o)for(var n=0;n<r.length;n++)r[n].setVisible(!0)},e.filteredItems,r),e.selectBeer=function(s,n){e.markerReset();for(var a,i=$(n.target).text(),l=0;l<r.length;l++)i===r[l].title&&(a=r[l],r[l].setIcon(t),e.currentLocation(i));$(n.target).css("color",o),google.maps.event.trigger(a,"click")},e.drawMap();var a=document.querySelector("#menu"),i=(document.querySelector("main"),document.querySelector("#drawer"));a.addEventListener("click",function(e){i.classList.toggle("open"),a.classList.toggle("is-active"),e.stopPropagation()})};window.onload=loadScript;